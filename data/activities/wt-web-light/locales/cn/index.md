翻译：自在飞叶

### 受Web浏览器控制的灯

本教程描述如何使得一盏灯受远程控制。远程控制方式可以通过micro:bit无线广播，也可以通过WebThings网关从浏览器发起。

### 第一步

1. 把micro:bit连接到Microblocks。
2. 定义一个变量，叫“亮灯状态”。该变量记住灯的打开或者熄灭状态。如果程序把该变量的值设定为真，那么灯打开；把它的值设定为假，灯熄灭。

选择“变量”积木类别，单击下图中的“新建一个变量”，将创建变量。

![新建一个变量](define-variable.png)

在弹出的对话框内输入变量的名字。下图把变量命名为“亮灯状态”。

![输入变量的名字](name-variable.png)

下图表明，“亮灯状态”变量已经新建完毕。

![变量建好了](variable-ready.png)

3. 下面的脚本做到以下两点：
    (1) 按下按键A，亮灯状态变量的值将变反。也就是说，原来是真的话，将变为假；原来为假的话，将变为真。
    (2) 一旦亮灯状态变量的值为真，那么将把一盏LED灯点亮（这盏LED灯位于micro:bit板子上的5x5 LED矩阵中的第一行第三列）；一旦亮灯状态变量的值为假，将熄灭该LED灯。

![按键A控制LED](key-A-toggle-light.png)

### 第二步

第二步的目标是，用一块micro:bit板子上的按键控制另一块micro:bit板子上的LED灯。

1. 添加“广播”积木库。单击“积木库”右边的+号，在弹出的对话框内选择“广播”，然后单击“打开”按钮。

![添加广播积木库](add-radio-lib.png)

2. 编写下面的脚本。这些脚本使得一块micro:bit板子上的按键控制另一块micro:bit板子上的LED灯。

![通过广播远程控制](radio-toggle-light.png)

上述脚本中，如果亮灯状态变量的值为真，将广播数字1，表示打开灯的指令；如果亮灯状态变量的值为假，将广播数字0，表示熄灭灯的指令。假如第一块板子发出数字1，第二块板子将收到数字1，也即【最新广播的数字】积木返回1，【【最新广播的数字】= 1】积木的结果是真，于是把第二块板子上的运行的程序内的亮灯状态变量值设定为真。此后，点亮第二块板子上的LED。

3. 测试的时候，先把第一块板子连接到Microblocks，然后断开连接（但继续插在USB口供电）；接着把第二块板子连接到Microblocks。点击Microblocks窗口右上角的绿色箭头，开始运行第二块板子上的脚本。

4. 在第一块板子上按下按键A，两块板子上的LED灯都将亮起来；再按一次，都熄灭；再按一次，都亮起；再按一次，都熄灭。这一切换过程可以反复进行。

5. 在第二块板子上按下按键A，功用是一样的。

### 第三步

第三步的目标是，通过浏览器控制micro:bit板子上的LED灯的开与关。

1. 首先，在树莓派（Raspberry Pi）板子上配置好WebThings网关。配置方法参阅名为“WebThings网关”的教程。

2. 把micro:bit板子通过USB连接到Microblocks。在Microblocks窗口内，添加WebThings积木库。做法是，单击“积木库”右边的+号，在弹出的对话框内选择“网络”，然后网络类别下选择“WebThings”，单击“打开”按钮。

![打开WebThings积木库](network-wot-lib.png)

3. 编写以下脚本。这些脚本将运行在micro:bit板子上。

![连接WebThings网关](microbit-hello-led.png)

对上述脚本，说明如下：
(1) 记住LED灯亮还是灭的变量是on。用法与前面提及的“亮灯状态”变量一样。
(2) 【当启动时】积木下方的三块积木用于连接WebThings网关。

4. 把micro:bit板子与Microblocks断开连接，接着通过USB把micro:bit板子连接到第1步提及的树莓派板子上。在登录成功后出现的页面上，单击右下角的加号，进入下图所示的页面。此时，正在搜索新设备。

![搜索新设备](search-device.png)

5. 搜索过程将发现名字为“Hello LED”的设备，单击保存按钮和完成按钮，新设备就受WebThings网关管理，如下图所示。

![添加新设备](add_hello_led.png)

6. 此后，单击上图所示页面上的灯泡图标，将点亮或者熄灭micro:bit板子上的LED，就像按下micro:bit板子的A键一样。

